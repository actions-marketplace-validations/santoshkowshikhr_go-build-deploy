name: "build"

on:
  push:
    tags:
      - "infra_setup"
    branches:
      - "infra_setup"
  pull_request:
    types: [opened, synchronize, reopened]    
  workflow_dispatch:
      branches:
      - "infra_setup"

env:
# Set HOME for refrencing the GOPATH
  HOME: ${{ github.workspace }}

jobs:
  build:
    name: "Build"
    runs-on: ['self-hosted','infra_id:gryphon-extractor']
    steps:
      - name: Code Checkout
        uses: actions/checkout@v2
        with:
          ssh-key: ${{ secrets.GLOBAL_FLEXERA_CI_PRIVATE_SSH_KEY }}
          submodules: recursive
          path: go/src/github.com/${{ github.repository }}

      - name: Setup Environment Variables
        run: |
          ## Set GOPATH
          echo "GOPATH=${GITHUB_WORKSPACE}/go" >> $GITHUB_ENV

      - name: Install go
        uses: actions/setup-go@v1
        with:
          go-version: 1.17
        id: go

      - name: Run golangci-lint
        uses: golangci/golangci-lint-action@v2.5.2
        with:
          working-directory: go/src/github.com/${{ github.repository }}